import base64
import hashlib
from Cryptodome.Cipher import Salsa20

def bytesToInt(b):
    return int.from_bytes(b,byteorder = 'big')

p = bytesToInt(b"""\xee\xff\xe2\xdb\xcb/K\x84t\xef\xc6\x15\x85\x9d\xa4~\xbeY\xd9\xa3X_\xe9\xe1\x1f6j\x97hI\x8a#\xd7\x99\xa3p\xc1EK\xe4\\\xe6+X\x9e\xb9\xc5F"\xfa2\xce\x02m\xfeXmk\x8f\xf1\xd7i\x95\xc1i\xe6\xed\x9fH\x0f\x0b\xf6g\xc8\x05^\xbef\xe4G>\x81\xff\xd0B\xb70M\xda\x7f\x0b>]\xf5\x80\xbd\xfd#\x088\rs)\x96\xbch\\h\x1d\x03\xfa\xe9\xa7\xee\x875aP*\x8dJ\x13c\xb4y\x96%r@S\xee\xaf\x92?\xca1)\xddU\xad^b\xe2\x95B2U\xfd]t\xa6\xd7\xe8\x8a?{\xa3h\xd2\xa1\xe3\xb1\xc1{\xcc\xa4Y\xcf\xee\xc4\xcdK\x881g\'TF\xdc\x1f0\xcfh\xe9\x1d,\xaa}UW\x06}\x7f\xb9Rh\x83k\x97v\xf9\t\xbb*a\xf6&\xd6\x05l\x84\xfa\x0c\xb5\x89s\xb2\x9b=f\x96\x99 YKfk\x1f\x7f\xc0\x93\xbe\xa1\xa4\x8e\x90p\xed\xb9{\x17\xbd\x0cU\xbb\xb3\x19\xe9\x9d\xd0\t?\x8cs\xb4_""")
ag = bytesToInt(b"""q\xcf\xeeGu\x99\xc7a\x85i\xaaBo8Q\x02\x1c\x80\x98+\xfcP\xa8\xf0\x7f+\xa7o`\xf0\xda\x9e\x91\xafO\x17\xae\xb4\x81TA\x83\x95\x0e2\x17\x86hV^ \xda\x8f\xe9\x0b]\x08\xc2\xe2\xd8\x8c\xb8\xc0R\xc6C\x82K\xe9b\xf0_\xc7\xc5htYD\x7f\x00\xcdb\x8f\xdf\x90\x81j\xf7(\xd0\xc5zk\x80Fh\xe2{\x84\xa72\xc8\r\x9bJs\xd2\xd7\xd7\x96\t\xfd\x83\x08\xbaM\xc3`v\x07\x80\xb1\xfb\x0e\xf6!x\xec<\xf1\xf0$\x8e\x8a*\xc4\n\x8b|\xfa\xae\x92X\xa9\x92^\x16#\xb1/\xd8\xbd\x01\x14\x9fY\x06\xd4D#\x1dkv\x9c\xba\x08\x9e\x93\x06\xcfm\xf0\xa7\x9d\xeeU7=\xfc1\xb4e\xfa\xb9\x16\xad^\xf5\x97\xca.#>S\x03faH<\xd6\xba\xe8\xd7\x1c\xc6$\x15\x8f&\xe4\xee}e\xe9\x17\xd96\xfd\x9c\x8d=\xbd\xc4\xdcr\x04h\xcf\xee\xaf\xb5\xb7>\x07G\xbf\xfd\xd0\x0b\xa54\xdd\xa7A\xb5\xaf\x0bsQ\x9bb\x96\x06\x05\x125""")
agb = bytesToInt(b"""2\xed{k\xf8\x8b\xfc\xd1c\x8a\x0e\x9f+\xdb=\xaa\xcd.\xbeh\x99/O\xd5n3\x96\xd5g\xe3\xa6\x10`m(\xad\xf1\x9a\xa4d\xee\x13J\xa3\xc4\xe1\x16\xf2\x9a\x12\xa1\xd0\xa4\xcf\xff\x0e\xc2Q^\x19a\xcd\xcb\xe4'\x93`\x92\xbbyas\xae\xfa\x85\x0b\\\xf8A'1\x02c\xbce\xc9\xbf^\xc7j\xda\xa8\xd0\xab\xe1\x06*\x10i\xc2\x1f\xe7Y$\x0f\xdd\xceU\xfdQ\xeati\xe9\x9b\xdb!I\xa5\xf7\x8do\t\xf8\xa2x_\x8dm\xbd\xfc\xba\xc6\x8b\xbf\x1f\xa0\xf3\x98\xe48\x8bo|\xd2,\xe7\x9e\xc9\x0c\xbe\xfd\xe3S-X\x06M\xb6\x9e\x1cQ\x11?\xa9i=\xfe\x1f$\x08\xb6\xd3g{\x17\xaa\xbe\xee\x12\xdd\xd9\x0f\xb4\x80\x87\x85\x10byb\xaf,_\xb6\tE\xa5zp\x8d5|\x14\xea\xd5 \x19\x1e\x9b\x1b~3\xb6y\xa2\xa9\xee.)\x82SI\xc6\x97\xe4J/\xadZ\x83\xe0G{T\xcc\xa1\xff\xc1a/\xee\x12\xa4\xf7\xc0B\xfdXBs\xe56RG\xd7""")
data = b"""Vc7xlNZEcp8366FNVr2W7tOR5GParGTUET5txKq0+RnN0Fqo3ex2qrg+Gr3w24RuXTlVyDXu2PTYSLoVjHW1heDaeJTtAJOFWIINVsXuhiw="""

print('p = %d' % p)
print('ag = %d' % ag)

def checkQR(n, p):
    if pow(n, (p - 1)//2, p) == 1:
        return True
    return False

q = p-1
s = 0
while q % 2 == 0:
    s += 1
    q //= 2

z = 1
while checkQR(z, p):
    z += 1

M = s
c = pow(z, q, p)
t = pow(ag, q, p)
R = pow(ag, (q + 1)//2, p)
r = 0
while True:
    if t == 0:
        r = 0
        break
    if t == 1:
        r = R
        break
    i = 0
    t1 = t
    while t1 != 1:
        t1 = pow(t1, 2, p)
        i += 1
    b = pow(c, pow(2, M - i - 1, p), p)
    M = i
    c = pow(b, 2, p)
    t = t * pow(b, 2, p) % p
    R = R * b % p

def decrypt(data, number):
    enc = base64.b64decode(data)
    seckey = hashlib.sha256(str(number).encode('utf-8')).digest()
    nonce = enc[:8]
    cipher = Salsa20.new(key=seckey, nonce=nonce)
    ciphertext = enc[8:]
    plaintext = cipher.decrypt(ciphertext)
    return base64.b64decode(plaintext)

print('a = %d' % r)
a = r
a1 = -a % p
key1 = pow(agb, a, p)
key2 = pow(agb, a1, p)

print(decrypt(data, key2))
print(decrypt(data, key1))